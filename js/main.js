// Generated by CoffeeScript 1.6.2
(function() {
  var ASSETS, BULLET_IMG, Bullet, PLAYER_IMG, Player, add, bullets, fighters, game, intoWindow, isInWindow, remove,
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  enchant();

  ASSETS = [PLAYER_IMG = 'player.png', BULLET_IMG = 'icon0.png'];

  game = null;

  fighters = null;

  bullets = null;

  add = function(inst) {
    return game.currentScene.addChild(inst);
  };

  remove = function(inst) {
    if (typeof inst.onremove === "function") {
      inst.onremove();
    }
    return game.currentScene.removeChild(inst);
  };

  isInWindow = function(node) {
    var _ref, _ref1;

    return (0 <= (_ref = node.x) && _ref < game.width) && (0 <= (_ref1 = node.y) && _ref1 < game.height);
  };

  intoWindow = function(node) {
    var t;

    if (node.x < 0) {
      node.x = 0;
    }
    t = game.width - 1 - node.width;
    if (node.x > t) {
      node.x = t;
    }
    if (node.y < 0) {
      node.y = 0;
    }
    t = game.height - 1 - node.height;
    if (node.y > t) {
      return node.y = t;
    }
  };

  Player = (function(_super) {
    __extends(Player, _super);

    function Player() {
      Player.__super__.constructor.call(this, 32, 32);
      this.image = game.assets[PLAYER_IMG];
      this.frame = 27;
      this.scale(2, 2);
      this.x = game.width / 2;
      this.y = game.height / 2;
      fighters.addChild(this);
    }

    Player.prototype.onenterframe = function() {
      if (game.frame % (game.fps / 10) === 0) {
        return new Bullet(this.x, this.y);
      }
    };

    return Player;

  })(Sprite);

  Bullet = (function(_super) {
    __extends(Bullet, _super);

    function Bullet(x, y) {
      Bullet.__super__.constructor.call(this, 16, 16);
      this.image = game.assets[BULLET_IMG];
      this.frame = 48;
      this.x = x;
      this.y = y;
      bullets.addChild(this);
    }

    Bullet.prototype.onenterframe = function() {
      this.y += -10;
      if (!isInWindow(this)) {
        return bullets.removeChild(this);
      }
    };

    return Bullet;

  })(Sprite);

  window.onload = function() {
    game = new Game(400, 600);
    game.fps = 60;
    game.preload(ASSETS);
    game.onload = function() {
      var bex, bey, player, scene;

      scene = game.rootScene;
      scene.backgroundColor = '#ffffff';
      bullets = new Group;
      add(bullets);
      fighters = new Group;
      add(fighters);
      player = new Player;
      bex = bey = 0;
      scene.addEventListener(Event.TOUCH_START, function(e) {
        bex = e.x;
        return bey = e.y;
      });
      return scene.addEventListener(Event.TOUCH_MOVE, function(e) {
        player.x += e.x - bex;
        player.y += e.y - bey;
        intoWindow(player);
        bex = e.x;
        return bey = e.y;
      });
    };
    return game.start();
  };

}).call(this);
